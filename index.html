
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Panel Interactivo de Campa침as</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font-family: 'Arial', sans-serif; background: #f4f7f6; color: #333; }
            .container { max-width: 1400px; margin: 20px auto; }
            .card { background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
            .header { background: #1e3c72; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
            .header h1 { font-size: 2em; }
            .filters { padding: 15px 20px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 20px; }
            .filters label { font-weight: bold; margin-right: 5px; }
            .filters input, .filters select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
            .post-links table { width: 100%; border-collapse: collapse; }
            .post-links th, .post-links td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
            .post-links th { background-color: #f8f9fa; }
            .post-links a { color: #007bff; text-decoration: none; font-weight: bold; }
            .post-links a:hover { text-decoration: underline; }
            .pagination-controls { text-align: center; padding: 15px; }
            .pagination-controls button, .filter-btn { padding: 8px 16px; margin: 0 5px; cursor: pointer; border: 1px solid #ccc; background-color: #fff; border-radius: 5px; font-weight: bold; }
            .pagination-controls button:disabled { cursor: not-allowed; background-color: #f8f9fa; color: #aaa; }
            .pagination-controls span { margin: 0 10px; font-weight: bold; vertical-align: middle; }
            .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; padding: 20px; }
            .stat-card { padding: 20px; text-align: center; border-left: 5px solid; }
            .stat-card.total { border-left-color: #007bff; } .stat-card.positive { border-left-color: #28a745; } .stat-card.negative { border-left-color: #dc3545; } .stat-card.neutral { border-left-color: #ffc107; } .stat-card.pautas { border-left-color: #6f42c1; }
            .stat-number { font-size: 2.5em; font-weight: bold; margin-bottom: 5px; }
            .positive-text { color: #28a745; } .negative-text { color: #dc3545; } .neutral-text { color: #ffc107; } .total-text { color: #007bff; } .pautas-text { color: #6f42c1; }
            .charts-section, .comments-section { padding: 20px; }
            .section-title { font-size: 1.5em; margin-bottom: 20px; text-align: center; color: #333; }
            .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
            .chart-container { position: relative; height: 400px; } .chart-container.full-width { grid-column: 1 / -1; }
            .comment-item { margin-bottom: 10px; padding: 15px; border-radius: 8px; border-left: 5px solid; word-wrap: break-word; }
            .comment-positive { border-left-color: #28a745; background: #f0fff4; } .comment-negative { border-left-color: #dc3545; background: #fff5f5; } .comment-neutral { border-left-color: #ffc107; background: #fffbeb; }
            .comment-meta { margin-bottom: 8px; font-size: 0.9em; display: flex; justify-content: space-between; align-items: center; }
            .comment-date { color: #6c757d; font-style: italic; }
            .comments-controls { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
            .filter-btn.active { background-color: #007bff; color: white; border-color: #007bff; }
            @media (max-width: 900px) { .charts-grid { grid-template-columns: 1fr; } }
        </style>
    </head>
    <body>
        <script id="data-store" type="application/json">[{"date": "2025-11-26T07:59:14", "comment": "\ud83e\udd70me gusta mucho esta propuesta de alpina \ud83d\ude02\ud83e\udd70\ud83e\udd70\ud83e\udd70\ud83d\ude01", "sentiment": "Positivo", "topic": "Opini\u00f3n General del Producto", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-21T23:01:04", "comment": "\ud83e\udd70 Que lindo que no es IA", "sentiment": "Positivo", "topic": "Otros", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-21T20:54:16", "comment": "por que\u0301 no explica que\u0301 clase de mascarilla de vino hacer co\u0301mo se prepara que\u0301 ingredientes le hecho", "sentiment": "Neutro", "topic": "Otros", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-21T20:43:02", "comment": "ese es el mapa al one piece?", "sentiment": "Neutro", "topic": "Otros", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-21T17:48:45", "comment": "Me gusta que no es IA", "sentiment": "Neutro", "topic": "Opini\u00f3n General del Producto", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-21T14:35:31", "comment": "Bendiciones \ud83e\udd70", "sentiment": "Positivo", "topic": "Fuera de Tema / No Relevante", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-21T13:49:32", "comment": "Que bello video gracias Alpina\ud83d\ude0a", "sentiment": "Positivo", "topic": "Fuera de Tema / No Relevante", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-21T09:43:11", "comment": "\u263a\ufe0f\u263a\ufe0f\ud83d\ude0a", "sentiment": "Neutro", "topic": "Fuera de Tema / No Relevante", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-19T23:44:08", "comment": "6", "sentiment": "Neutro", "topic": "Fuera de Tema / No Relevante", "platform": "TikTok", "post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_label": "Pauta 2 (TikTok)"}, {"date": "2025-11-23T18:37:25", "comment": "Pp099p99", "sentiment": "Neutro", "topic": "Fuera de Tema / No Relevante", "platform": "Facebook", "post_url": "https://www.facebook.com/100064867445065/posts/pfbid02qLKsWnTscnt4fxoxbp2H8DLmNMVurZcBpUBuwZEZzTwyX1YkYmYENbHa5UHu6Dg8l?dco_ad_id=120238433999820589", "post_label": "Pauta 3 (Facebook)"}, {"date": "2025-11-21T18:26:50", "comment": "Hola te ves bn tienes buena imagen personal.", "sentiment": "Positivo", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064867445065/posts/pfbid02qLKsWnTscnt4fxoxbp2H8DLmNMVurZcBpUBuwZEZzTwyX1YkYmYENbHa5UHu6Dg8l?dco_ad_id=120238433999820589", "post_label": "Pauta 3 (Facebook)"}, {"date": "2025-11-21T01:15:56", "comment": "Tinga linga linga tinga linga tuuuuu", "sentiment": "Neutro", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064867445065/posts/pfbid02qLKsWnTscnt4fxoxbp2H8DLmNMVurZcBpUBuwZEZzTwyX1YkYmYENbHa5UHu6Dg8l?dco_ad_id=120238433999820589", "post_label": "Pauta 3 (Facebook)"}, {"date": "2025-11-19T16:27:18", "comment": "Yamen l al polici\u0301a para k les quiten los perritos", "sentiment": "Negativo", "topic": "Fuera de Tema / No Relevante", "platform": "Facebook", "post_url": "https://www.facebook.com/100064867445065/posts/pfbid02qLKsWnTscnt4fxoxbp2H8DLmNMVurZcBpUBuwZEZzTwyX1YkYmYENbHa5UHu6Dg8l?dco_ad_id=120238433999820589", "post_label": "Pauta 3 (Facebook)"}, {"date": "2025-11-20T07:45:06", "comment": "Listo", "sentiment": "Neutro", "topic": "Fuera de Tema / No Relevante", "platform": "Facebook", "post_url": "https://www.facebook.com/100064867445065/posts/pfbid036iaCTpHgEiiR2DT4ZQ8FoZtCogRjyg3nAXxtVXh3XXRdduTJDg4fThnwZ742KgvPl?dco_ad_id=120238433999800589", "post_label": "Pauta 4 (Facebook)"}, {"date": "2025-11-20T06:13:11", "comment": "ZAMBRANO UNA  VERGUENSA!!! APROVECHADO Y AMBICIOSO!! Q PENA!!!!", "sentiment": "Negativo", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064867445065/posts/pfbid036iaCTpHgEiiR2DT4ZQ8FoZtCogRjyg3nAXxtVXh3XXRdduTJDg4fThnwZ742KgvPl?dco_ad_id=120238433999800589", "post_label": "Pauta 4 (Facebook)"}, {"date": "2025-11-25T23:06:53", "comment": "Ni uno ni dos ni tres ya es imposible poder comer un bon yurt su costo cada di\u0301a esta por las nubes, soli\u0301a ser mi postre \ud83c\udf68 favorito pero esta tan costoso que ni recuerdo su sabor \ud83d\ude14", "sentiment": "Negativo", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-25T23:06:53", "comment": "Ni uno ni dos ni tres ya es imposible poder comer un bon yurt su costo cada di\u0301a esta por las nubes, soli\u0301a ser mi postre \ud83c\udf68 favorito pero esta tan costoso que ni recuerdo su sabor \ud83d\ude14", "sentiment": "Negativo", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-25T22:38:22", "comment": "Como los de me infancia", "sentiment": "Neutro", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-25T22:38:22", "comment": "Como los de me infancia", "sentiment": "Neutro", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-25T00:11:04", "comment": "Esq eso era muy caro un rin\u0303o\u0301n pra\u0301cticamente ps pero vale la pena", "sentiment": "Neutro", "topic": "Fuera de Tema / No Relevante", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-25T00:11:04", "comment": "Esq eso era muy caro un rin\u0303o\u0301n pra\u0301cticamente ps pero vale la pena", "sentiment": "Neutro", "topic": "Fuera de Tema / No Relevante", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-24T23:34:17", "comment": "Cuando eran ricos y trai\u0301an ma\u0301s que aire", "sentiment": "Neutro", "topic": "Opini\u00f3n General del Producto", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-24T23:34:17", "comment": "Cuando eran ricos y trai\u0301an ma\u0301s que aire", "sentiment": "Neutro", "topic": "Opini\u00f3n General del Producto", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-24T22:23:08", "comment": "Pos si como tres me da un coma diabe\u0301tico....", "sentiment": "Negativo", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-24T22:23:08", "comment": "Pos si como tres me da un coma diabe\u0301tico....", "sentiment": "Negativo", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_label": "Pauta 1 (Facebook)"}, {"date": "2025-11-25T21:59:40", "comment": "Y la de su hijo cuando sale,o por esa sentencia que la oculten.", "sentiment": "Negativo", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767296289015/", "post_label": "Pauta 5 (Facebook)"}, {"date": "2025-11-25T20:57:43", "comment": "El kumis es pura agua y dulce", "sentiment": "Positivo", "topic": "Otros", "platform": "Facebook", "post_url": "https://www.facebook.com/100064672685926/posts/1258767296289015/", "post_label": "Pauta 5 (Facebook)"}, {"date": "2025-11-20T01:19:39", "comment": "De la Moradita", "sentiment": "Neutro", "topic": "Otros", "platform": "Instagram", "post_url": "https://www.instagram.com/p/DRPexY8jPUB/", "post_label": "Pauta 6 (Instagram)"}]</script>
        <script id="posts-data-store" type="application/json">[{"post_url": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "post_url_original": "https://www.facebook.com/100064672685926/posts/1258767229622355/", "platform": "Facebook", "comment_count": 10.0, "post_label": "Pauta 1 (Facebook)"}, {"post_url": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "post_url_original": "https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52", "platform": "TikTok", "comment_count": 9.0, "post_label": "Pauta 2 (TikTok)"}, {"post_url": "https://www.facebook.com/100064867445065/posts/pfbid02qLKsWnTscnt4fxoxbp2H8DLmNMVurZcBpUBuwZEZzTwyX1YkYmYENbHa5UHu6Dg8l?dco_ad_id=120238433999820589", "post_url_original": "https://www.facebook.com/100064867445065/posts/pfbid02qLKsWnTscnt4fxoxbp2H8DLmNMVurZcBpUBuwZEZzTwyX1YkYmYENbHa5UHu6Dg8l?dco_ad_id=120238433999820589", "platform": "Facebook", "comment_count": 4.0, "post_label": "Pauta 3 (Facebook)"}, {"post_url": "https://www.facebook.com/100064867445065/posts/pfbid036iaCTpHgEiiR2DT4ZQ8FoZtCogRjyg3nAXxtVXh3XXRdduTJDg4fThnwZ742KgvPl?dco_ad_id=120238433999800589", "post_url_original": "https://www.facebook.com/100064867445065/posts/pfbid036iaCTpHgEiiR2DT4ZQ8FoZtCogRjyg3nAXxtVXh3XXRdduTJDg4fThnwZ742KgvPl?dco_ad_id=120238433999800589", "platform": "Facebook", "comment_count": 2.0, "post_label": "Pauta 4 (Facebook)"}, {"post_url": "https://www.facebook.com/100064672685926/posts/1258767296289015/", "post_url_original": "https://www.facebook.com/100064672685926/posts/1258767296289015/", "platform": "Facebook", "comment_count": 2.0, "post_label": "Pauta 5 (Facebook)"}, {"post_url": "https://www.instagram.com/p/DRPexY8jPUB/", "post_url_original": "https://www.instagram.com/p/DRPexY8jPUB/", "platform": "Instagram", "comment_count": 1.0, "post_label": "Pauta 6 (Instagram)"}, {"post_url": "https://www.facebook.com/100064672685926/posts/1247221154110296/", "post_url_original": "https://www.facebook.com/100064672685926/posts/1247221154110296/", "platform": "Facebook", "comment_count": 0.0, "post_label": "Pauta 7 (Facebook)"}]</script>

        <div class="container">
            <div class="card">
                <div class="header"><h1>游늵 Panel Interactivo de Campa침as</h1></div>
                <div class="filters">
                    <label for="startDate">Inicio:</label> <input type="date" id="startDate" value="2025-11-19"> <input type="time" id="startTime" value="00:00">
                    <label for="endDate">Fin:</label> <input type="date" id="endDate" value="2025-11-26"> <input type="time" id="endTime" value="23:59">
                    <label for="platformFilter">Red Social:</label> <select id="platformFilter"><option value="Todas">Todas</option><option value="Facebook">Facebook</option><option value="Instagram">Instagram</option><option value="TikTok">TikTok</option></select>
                    <label for="postFilter">Pauta Espec칤fica:</label> <select id="postFilter"><option value="Todas">Ver Todas las Pautas</option><option value="https://www.facebook.com/100064672685926/posts/1258767229622355/">Pauta 1 (Facebook)</option><option value="https://www.tiktok.com/@alpinacol/video/7574526148311289096?_r=1&_t=ZS-91hDH592E52">Pauta 2 (TikTok)</option><option value="https://www.facebook.com/100064867445065/posts/pfbid02qLKsWnTscnt4fxoxbp2H8DLmNMVurZcBpUBuwZEZzTwyX1YkYmYENbHa5UHu6Dg8l?dco_ad_id=120238433999820589">Pauta 3 (Facebook)</option><option value="https://www.facebook.com/100064867445065/posts/pfbid036iaCTpHgEiiR2DT4ZQ8FoZtCogRjyg3nAXxtVXh3XXRdduTJDg4fThnwZ742KgvPl?dco_ad_id=120238433999800589">Pauta 4 (Facebook)</option><option value="https://www.facebook.com/100064672685926/posts/1258767296289015/">Pauta 5 (Facebook)</option><option value="https://www.instagram.com/p/DRPexY8jPUB/">Pauta 6 (Instagram)</option><option value="https://www.facebook.com/100064672685926/posts/1247221154110296/">Pauta 7 (Facebook)</option></select>
                    <label for="topicFilter">Tema:</label> <select id="topicFilter"><option value="Todos">Todos los Temas</option></select>
                </div>
            </div>
            
            <div class="card post-links">
                <h2 class="section-title">Listado de Pautas Activas</h2>
                <div id="post-links-table"></div>
                <div id="post-links-pagination" class="pagination-controls"></div>
            </div>

            <div class="card"><div id="stats-grid" class="stats-grid"></div></div>
            
            <div class="card charts-section">
                <h2 class="section-title">An치lisis General</h2>
                <div class="charts-grid">
                    <div class="chart-container"><canvas id="postCountChart"></canvas></div>
                    <div class="chart-container"><canvas id="sentimentChart"></canvas></div>
                    <div class="chart-container"><canvas id="topicsChart"></canvas></div>
                    <div class="chart-container full-width"><canvas id="sentimentByTopicChart"></canvas></div>
                    <div class="chart-container full-width"><canvas id="dailyChart"></canvas></div>
                    <div class="chart-container full-width"><canvas id="hourlyChart"></canvas></div>
                </div>
            </div>
            
            <div class="card comments-section">
                <h2 class="section-title">游눫 Comentarios Filtrados</h2>
                <div id="comments-controls" class="comments-controls"></div>
                <div id="comments-list"></div>
                <div id="comments-pagination" class="pagination-controls"></div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const allData = JSON.parse(document.getElementById('data-store').textContent);
                const allPostsData = JSON.parse(document.getElementById('posts-data-store').textContent);
                
                const startDateInput = document.getElementById('startDate'), startTimeInput = document.getElementById('startTime');
                const endDateInput = document.getElementById('endDate'), endTimeInput = document.getElementById('endTime');
                const platformFilter = document.getElementById('platformFilter'), postFilter = document.getElementById('postFilter');
                const topicFilter = document.getElementById('topicFilter');

                // Inicializar filtro de temas con los temas 칰nicos del dataset
                const uniqueTopics = [...new Set(allData.map(d => d.topic))].sort();
                uniqueTopics.forEach(topic => {
                    const option = document.createElement('option');
                    option.value = topic;
                    option.textContent = topic;
                    topicFilter.appendChild(option);
                });

                const charts = {};
                Object.assign(charts, {
                    postCount: new Chart(document.getElementById('postCountChart'), { type: 'doughnut', options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: 'Distribuci칩n de Pautas por Red Social' } } } }),
                    sentiment: new Chart(document.getElementById('sentimentChart'), { type: 'doughnut', options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: 'Distribuci칩n de Sentimientos' } } } }),
                    topics: new Chart(document.getElementById('topicsChart'), { type: 'doughnut', options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: 'Distribuci칩n por Temas' } } } }),
                    sentimentByTopic: new Chart(document.getElementById('sentimentByTopicChart'), { type: 'bar', options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { stacked: true }, y: { stacked: true } }, plugins: { title: { display: true, text: 'Sentimiento por Tema' } } } }),
                    daily: new Chart(document.getElementById('dailyChart'), { type: 'bar', options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } }, plugins: { title: { display: true, text: 'Volumen de Comentarios por D칤a' } } } }),
                    hourly: new Chart(document.getElementById('hourlyChart'), { type: 'bar', options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, position: 'left', title: { display: true, text: 'Comentarios por Hora' } }, y1: { position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'Total Acumulado' } } }, plugins: { title: { display: true, text: 'Volumen de Comentarios por Hora' } } } })
                });

                let postLinksCurrentPage = 1;
                const POST_LINKS_PER_PAGE = 5;
                let commentsCurrentPage = 1;
                const COMMENTS_PER_PAGE = 10;
                let commentsSentimentFilter = 'Todos';

                const updatePostLinks = () => {
                    const selectedPlatform = platformFilter.value;
                    const selectedTopic = topicFilter.value;
                    
                    // Filtrar pautas por plataforma
                    let postsToShow = (selectedPlatform === 'Todas') ? allPostsData : allPostsData.filter(p => p.platform === selectedPlatform);
                    
                    // Filtrar pautas por tema
                    if (selectedTopic !== 'Todos') {
                        const urlsWithTopic = new Set(
                            allData.filter(d => d.topic === selectedTopic).map(d => d.post_url)
                        );
                        postsToShow = postsToShow.filter(p => urlsWithTopic.has(p.post_url));
                        
                        // Recalcular conteos de comentarios solo para el tema seleccionado
                        postsToShow = postsToShow.map(p => {
                            const topicComments = allData.filter(d => d.post_url === p.post_url && d.topic === selectedTopic);
                            return {
                                ...p,
                                comment_count: topicComments.length,
                                original_count: p.comment_count
                            };
                        });
                        
                        // Re-ordenar por conteo de comentarios del tema
                        postsToShow.sort((a, b) => b.comment_count - a.comment_count);
                    }
                    
                    const tableDiv = document.getElementById('post-links-table');
                    const paginationDiv = document.getElementById('post-links-pagination');
                    tableDiv.innerHTML = ''; paginationDiv.innerHTML = '';
                    
                    if (postsToShow.length === 0) {
                        tableDiv.innerHTML = "<p style='text-align:center; padding:20px;'>No hay pautas con comentarios del tema seleccionado.</p>";
                        return;
                    }

                    const totalPages = Math.ceil(postsToShow.length / POST_LINKS_PER_PAGE);
                    if (postLinksCurrentPage > totalPages) postLinksCurrentPage = 1;

                    const startIndex = (postLinksCurrentPage - 1) * POST_LINKS_PER_PAGE;
                    const paginatedPosts = postsToShow.slice(startIndex, startIndex + POST_LINKS_PER_PAGE);

                    let tableHTML = '<table><tr><th>Pauta</th><th>Comentarios';
                    if (selectedTopic !== 'Todos') {
                        tableHTML += ' (Tema Seleccionado)';
                    }
                    tableHTML += '</th><th>Enlace</th></tr>';
                    
                    paginatedPosts.forEach(p => {
                        const linkUrl = p.post_url_original || p.post_url;
                        tableHTML += `<tr><td>${p.post_label}</td><td><b>${p.comment_count}</b></td><td><a href="${linkUrl}" target="_blank">Ver Pauta</a></td></tr>`;
                    });
                    tableHTML += '</table>';
                    tableDiv.innerHTML = tableHTML;

                    if (totalPages > 1) {
                        paginationDiv.innerHTML = `<button id="prevPageBtn" ${ (postLinksCurrentPage === 1) ? 'disabled' : '' }>Anterior</button><span>P치gina ${postLinksCurrentPage} de ${totalPages}</span><button id="nextPageBtn" ${ (postLinksCurrentPage === totalPages) ? 'disabled' : '' }>Siguiente</button>`;
                        document.getElementById('prevPageBtn')?.addEventListener('click', () => { if (postLinksCurrentPage > 1) { postLinksCurrentPage--; updatePostLinks(); } });
                        document.getElementById('nextPageBtn')?.addEventListener('click', () => { if (postLinksCurrentPage < totalPages) { postLinksCurrentPage++; updatePostLinks(); } });
                    }
                };
                
                const updateDashboard = () => {
                    const startFilter = `${startDateInput.value}T${startTimeInput.value}:00`;
                    const endFilter = `${endDateInput.value}T${endTimeInput.value}:59`;
                    const selectedPlatform = platformFilter.value;
                    const selectedPost = postFilter.value;
                    const selectedTopic = topicFilter.value;
                    
                    // Filtrar por fecha primero
                    let filteredData = allData.filter(d => d.date >= startFilter && d.date <= endFilter);
                    let postsToShow = allPostsData;

                    // Filtrar por post espec칤fico
                    if (selectedPost !== 'Todas') {
                        filteredData = filteredData.filter(d => d.post_url === selectedPost);
                        postsToShow = allPostsData.filter(p => p.post_url === selectedPost);
                    } else if (selectedPlatform !== 'Todas') {
                        filteredData = filteredData.filter(d => d.platform === selectedPlatform);
                        postsToShow = allPostsData.filter(p => p.platform === selectedPlatform);
                    }

                    // Filtrar por tema
                    if (selectedTopic !== 'Todos') {
                        filteredData = filteredData.filter(d => d.topic === selectedTopic);
                    }
                    
                    updateStats(filteredData, postsToShow.length);
                    updateCharts(allPostsData, filteredData);
                    updateCommentsList(filteredData);
                };
                
                const updateStats = (data, totalPosts) => {
                    const total = data.length;
                    const sentiments = data.reduce((acc, curr) => { acc[curr.sentiment] = (acc[curr.sentiment] || 0) + 1; return acc; }, {});
                    const pos = sentiments['Positivo'] || 0;
                    const neg = sentiments['Negativo'] || 0;
                    const neu = sentiments['Neutro'] || 0;
                    
                    document.getElementById('stats-grid').innerHTML = `
                        <div class="stat-card pautas">
                            <div class="stat-number pautas-text">${totalPosts}</div>
                            <div>Total Pautas</div>
                        </div>
                        <div class="stat-card total">
                            <div class="stat-number total-text">${total}</div>
                            <div>Total Comentarios</div>
                        </div>
                        <div class="stat-card positive">
                            <div class="stat-number positive-text">${pos}</div>
                            <div>Positivos (${(total > 0 ? (pos / total * 100) : 0).toFixed(1)}%)</div>
                        </div>
                        <div class="stat-card negative">
                            <div class="stat-number negative-text">${neg}</div>
                            <div>Negativos (${(total > 0 ? (neg / total * 100) : 0).toFixed(1)}%)</div>
                        </div>
                        <div class="stat-card neutral">
                            <div class="stat-number neutral-text">${neu}</div>
                            <div>Neutros (${(total > 0 ? (neu / total * 100) : 0).toFixed(1)}%)</div>
                        </div>
                    `;
                };
                
                const updateCommentsList = (data) => {
                    const dataToShow = (commentsSentimentFilter === 'Todos') ? data : data.filter(d => d.sentiment === commentsSentimentFilter);
                    dataToShow.sort((a, b) => b.date.localeCompare(a.date));

                    const controlsDiv = document.getElementById('comments-controls');
                    const listDiv = document.getElementById('comments-list');
                    const paginationDiv = document.getElementById('comments-pagination');
                    listDiv.innerHTML = ''; paginationDiv.innerHTML = '';
                    
                    controlsDiv.innerHTML = ['Todos', 'Positivo', 'Negativo', 'Neutro'].map(s => 
                        `<button class="filter-btn ${commentsSentimentFilter === s ? 'active' : ''}" data-sentiment="${s}">${s}</button>`
                    ).join('');
                    
                    controlsDiv.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            commentsSentimentFilter = e.target.dataset.sentiment;
                            commentsCurrentPage = 1;
                            updateCommentsList(data);
                        });
                    });

                    if (dataToShow.length === 0) {
                        listDiv.innerHTML = "<p style='text-align:center;'>No hay comentarios para mostrar.</p>";
                        return;
                    }

                    const totalPages = Math.ceil(dataToShow.length / COMMENTS_PER_PAGE);
                    if (commentsCurrentPage > totalPages) commentsCurrentPage = 1;

                    const startIndex = (commentsCurrentPage - 1) * COMMENTS_PER_PAGE;
                    const paginatedComments = dataToShow.slice(startIndex, startIndex + COMMENTS_PER_PAGE);

                    const sentimentToCss = { 'Positivo': 'positive', 'Negativo': 'negative', 'Neutro': 'neutral' };
                    let listHtml = '';
                    paginatedComments.forEach(d => {
                        const escapedComment = d.comment.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                        const formattedDate = new Date(d.date).toLocaleString('es-CO', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute:'2-digit' });
                        listHtml += `<div class="comment-item comment-${sentimentToCss[d.sentiment]}">
                                        <div class="comment-meta">
                                            <strong>[${d.sentiment.toUpperCase()}] (Tema: ${d.topic})</strong>
                                            <span class="comment-date">${formattedDate}</span>
                                        </div>
                                        <div>${escapedComment}</div>
                                    </div>`;
                    });
                    listDiv.innerHTML = listHtml;

                    if (totalPages > 1) {
                        paginationDiv.innerHTML = `<button id="prevCommentPageBtn" ${ (commentsCurrentPage === 1) ? 'disabled' : '' }>Anterior</button><span>P치gina ${commentsCurrentPage} de ${totalPages}</span><button id="nextCommentPageBtn" ${ (commentsCurrentPage === totalPages) ? 'disabled' : '' }>Siguiente</button>`;
                        document.getElementById('prevCommentPageBtn')?.addEventListener('click', () => { if (commentsCurrentPage > 1) { commentsCurrentPage--; updateCommentsList(data); } });
                        document.getElementById('nextCommentPageBtn')?.addEventListener('click', () => { if (commentsCurrentPage < totalPages) { commentsCurrentPage++; updateCommentsList(data); } });
                    }
                };

                const updateCharts = (postsData, filteredData) => { 
                    // Gr치fico de pautas por plataforma
                    const postCounts = postsData.reduce((acc, curr) => { acc[curr.platform] = (acc[curr.platform] || 0) + 1; return acc; }, {}); 
                    const postCountLabels = Object.keys(postCounts); 
                    charts.postCount.data.labels = postCountLabels; 
                    charts.postCount.data.datasets = [{ data: postCountLabels.map(p => postCounts[p]), backgroundColor: ['#007bff', '#6f42c1', '#dc3545', '#ffc107', '#28a745'] }]; 
                    charts.postCount.update(); 
                    
                    // Gr치fico de sentimientos
                    const sentimentCounts = filteredData.reduce((acc, curr) => { acc[curr.sentiment] = (acc[curr.sentiment] || 0) + 1; return acc; }, {}); 
                    charts.sentiment.data.labels = ['Positivo', 'Negativo', 'Neutro']; 
                    charts.sentiment.data.datasets = [{ data: [sentimentCounts['Positivo']||0, sentimentCounts['Negativo']||0, sentimentCounts['Neutro']||0], backgroundColor: ['#28a745', '#dc3545', '#ffc107'] }]; 
                    charts.sentiment.update(); 
                    
                    // NUEVO: Gr치fico de pastel por temas
                    const topicCounts = filteredData.reduce((acc, curr) => { acc[curr.topic] = (acc[curr.topic] || 0) + 1; return acc; }, {}); 
                    const sortedTopics = Object.entries(topicCounts).sort((a, b) => b[1] - a[1]); 
                    const topicLabels = sortedTopics.map(d => d[0]);
                    const topicData = sortedTopics.map(d => d[1]);
                    
                    // Paleta de colores para temas
                    const topicColors = ['#3498db', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c', '#34495e', '#95a5a6', '#e67e22', '#16a085', '#c0392b'];
                    
                    charts.topics.data.labels = topicLabels; 
                    charts.topics.data.datasets = [{ 
                        data: topicData, 
                        backgroundColor: topicColors.slice(0, topicLabels.length) 
                    }]; 
                    charts.topics.update(); 
                    
                    // Sentimiento por tema (gr치fico de barras)
                    const sbtCounts = filteredData.reduce((acc, curr) => { if (!acc[curr.topic]) acc[curr.topic] = { Positivo: 0, Negativo: 0, Neutro: 0 }; acc[curr.topic][curr.sentiment]++; return acc; }, {}); 
                    const sbtLabels = Object.keys(sbtCounts).sort((a,b) => (sbtCounts[b].Positivo + sbtCounts[b].Negativo + sbtCounts[b].Neutro) - (sbtCounts[a].Positivo + sbtCounts[a].Negativo + sbtCounts[a].Neutro)); 
                    charts.sentimentByTopic.data.labels = sbtLabels; 
                    charts.sentimentByTopic.data.datasets = [ 
                        { label: 'Positivo', data: sbtLabels.map(l => sbtCounts[l].Positivo), backgroundColor: '#28a745' }, 
                        { label: 'Negativo', data: sbtLabels.map(l => sbtCounts[l].Negativo), backgroundColor: '#dc3545' }, 
                        { label: 'Neutro', data: sbtLabels.map(l => sbtCounts[l].Neutro), backgroundColor: '#ffc107' } 
                    ]; 
                    charts.sentimentByTopic.update(); 
                    
                    // Volumen diario
                    const dailyCounts = filteredData.reduce((acc, curr) => { const day = curr.date.substring(0, 10); if (!acc[day]) { acc[day] = { Positivo: 0, Negativo: 0, Neutro: 0 }; } acc[day][curr.sentiment]++; return acc; }, {}); 
                    const sortedDays = Object.keys(dailyCounts).sort(); 
                    charts.daily.data.labels = sortedDays.map(d => new Date(d+'T00:00:00').toLocaleDateString('es-CO', { year: 'numeric', month: 'short', day: 'numeric' })); 
                    charts.daily.data.datasets = [ 
                        { label: 'Positivo', data: sortedDays.map(d => dailyCounts[d].Positivo), backgroundColor: '#28a745' }, 
                        { label: 'Negativo', data: sortedDays.map(d => dailyCounts[d].Negativo), backgroundColor: '#dc3545' }, 
                        { label: 'Neutro', data: sortedDays.map(d => dailyCounts[d].Neutro), backgroundColor: '#ffc107' } 
                    ]; 
                    charts.daily.update(); 
                    
                    // Volumen por hora
                    const hourlyCounts = filteredData.reduce((acc, curr) => { const hour = curr.date.substring(0, 13) + ':00:00'; if (!acc[hour]) acc[hour] = { Positivo: 0, Negativo: 0, Neutro: 0, Total: 0 }; acc[hour][curr.sentiment]++; acc[hour].Total++; return acc; }, {}); 
                    const sortedHours = Object.keys(hourlyCounts).sort(); 
                    let cumulative = 0; 
                    const cumulativeData = sortedHours.map(h => { cumulative += hourlyCounts[h].Total; return cumulative; }); 
                    charts.hourly.data.labels = sortedHours.map(h => new Date(h).toLocaleString('es-CO', { day: '2-digit', month: 'short', hour: '2-digit', minute:'2-digit' })); 
                    charts.hourly.data.datasets = [ 
                        { label: 'Positivo', data: sortedHours.map(h => hourlyCounts[h].Positivo), backgroundColor: '#28a745', yAxisID: 'y' }, 
                        { label: 'Negativo', data: sortedHours.map(h => hourlyCounts[h].Negativo), backgroundColor: '#dc3545', yAxisID: 'y' }, 
                        { label: 'Neutro', data: sortedHours.map(h => hourlyCounts[h].Neutro), backgroundColor: '#ffc107', yAxisID: 'y' }, 
                        { label: 'Acumulado', type: 'line', data: cumulativeData, borderColor: '#007bff', yAxisID: 'y1' } 
                    ]; 
                    charts.hourly.update(); 
                };
                
                const updatePostFilterOptions = () => { 
                    const selectedPlatform = platformFilter.value; 
                    const currentPostSelection = postFilter.value; 
                    let postsToShow = (selectedPlatform === 'Todas') ? allPostsData : allPostsData.filter(p => p.platform === selectedPlatform); 
                    postFilter.innerHTML = '<option value="Todas">Ver Todas las Pautas</option>'; 
                    postsToShow.forEach(p => { postFilter.innerHTML += `<option value="${p.post_url}">${p.post_label}</option>`; }); 
                    if (postsToShow.some(p => p.post_url === currentPostSelection)) { postFilter.value = currentPostSelection; } 
                    else { postFilter.value = 'Todas'; } 
                };

                platformFilter.addEventListener('change', () => { updatePostFilterOptions(); postLinksCurrentPage = 1; updatePostLinks(); updateDashboard(); });
                postFilter.addEventListener('change', updateDashboard);
                topicFilter.addEventListener('change', () => { postLinksCurrentPage = 1; updatePostLinks(); updateDashboard(); });
                startDateInput.addEventListener('change', updateDashboard); 
                startTimeInput.addEventListener('change', updateDashboard);
                endDateInput.addEventListener('change', updateDashboard); 
                endTimeInput.addEventListener('change', updateDashboard);
                
                updatePostLinks();
                updateDashboard();
            });
        </script>
    </body>
    </html>
    